import { VerticalBox, HorizontalBox, Slider } from "std-widgets.slint";

// --- Badge Page (main name card display) ---
component BadgePage inherits Rectangle {
    in-out property <string> display-name: "Hebu";
    in-out property <string> tagline: "Hello from VRCBadge!";
    in-out property <string> twitter-handle: "@Hebu_VRC";
    in-out property <string> discord-handle: "hebu";
    in-out property <int> battery-percent: 100;
    in property <image> background-image;
    in property <image> avatar-image;
    in property <color> background-color: #1a1a2e;
    in property <color> tagline-color: #e0e8f0;
    in property <color> tagline-background-color: #1b4f72;

    callback open-settings();

    background: root.background-color;

    // === Background image (behind everything, only shown if uploaded) ===
    Image {
        visible: root.background-image.width > 0;
        x: 0px;
        y: 0px;
        width: 480px;
        height: 320px;
        source: root.background-image;
        image-fit: cover;
    }

    // === Layer 0: Accent bar ===
    Rectangle {
        x: 0px;
        y: 95px;
        width: 480px;
        height: 36px;
        background: root.tagline-background-color;

        // Tagline text on the bar
        Text {
            x: 190px;
            width: 270px;
            text: root.tagline;
            font-size: 16px;
            font-weight: 500;
            color: root.tagline-color;
            vertical-alignment: center;
            overflow: elide;
        }
    }

    // === Layer 1: Avatar (on top of accent bar) ===
    Rectangle {
        x: 20px;
        y: 45px;
        width: 150px;
        height: 150px;
        border-radius: 16px;
        background: #2a2a4a;
        border-width: 2px;
        border-color: #3a3a5a;
        clip: true;

        Image {
            source: root.avatar-image.width > 0 ? root.avatar-image : @image-url("../images/profile/sample.png");
            width: 100%;
            height: 100%;
            image-fit: cover;
        }
    }

    // === Layer 2: Right column content ===

    // Display name
    Text {
        x: 190px;
        y: 55px;
        width: 270px;
        text: root.display-name;
        font-size: 32px;
        font-weight: 700;
        color: #ffffff;
        overflow: elide;
    }

    // Social handles (right-middle)

    // Twitter / X handle
    HorizontalLayout {
        x: 190px;
        y: 145px;
        height: 18px;
        spacing: 4px;
        alignment: start;

        Rectangle {
            width: 14px;
            height: 14px;

            Image {
                source: @image-url("../images/logos/twitter.png");
                width: 13px;
                height: 13px;
                x: 0.5px;
                y: 0.5px;
                image-fit: contain;
            }
        }

        Text {
            text: root.twitter-handle;
            font-size: 14px;
            color: #1da1f2;
            vertical-alignment: center;
        }
    }

    // Discord handle
    HorizontalLayout {
        x: 190px;
        y: 167px;
        height: 18px;
        spacing: 4px;
        alignment: start;

        Rectangle {
            width: 14px;
            height: 14px;

            Image {
                source: @image-url("../images/logos/discord.png");
                width: 14px;
                height: 14px;
                image-fit: contain;
            }
        }

        Text {
            text: root.discord-handle;
            font-size: 14px;
            color: #7289da;
            vertical-alignment: center;
        }
    }

    // VRChat logo (bottom-right, white, no background)
    Image {
        source: @image-url("../images/logos/vrchat.png");
        x: 350px;
        y: 225px;
        width: 110px;
        height: 48px;
        image-fit: contain;
    }

    // Battery indicator
    Rectangle {
        x: 370px;
        y: 290px;
        width: 90px;
        height: 24px;

        HorizontalLayout {
            spacing: 4px;
            alignment: end;

            Text {
                text: root.battery-percent + "%";
                font-size: 14px;
                font-weight: 700;
                color: root.battery-percent > 20 ? #4caf50 : #f44336;
                vertical-alignment: center;
            }

            // Battery icon (stacked Phosphor SVGs with visibility conditions)
            Rectangle {
                width: 24px;
                height: 24px;

                Image {
                    visible: root.battery-percent > 75;
                    source: @image-url("../images/icons/battery-full.png");
                    width: 24px;
                    height: 24px;
                    image-fit: contain;
                }

                Image {
                    visible: root.battery-percent > 50 && root.battery-percent <= 75;
                    source: @image-url("../images/icons/battery-high.png");
                    width: 24px;
                    height: 24px;
                    image-fit: contain;
                }

                Image {
                    visible: root.battery-percent > 25 && root.battery-percent <= 50;
                    source: @image-url("../images/icons/battery-medium.png");
                    width: 24px;
                    height: 24px;
                    image-fit: contain;
                }

                Image {
                    visible: root.battery-percent > 10 && root.battery-percent <= 25;
                    source: @image-url("../images/icons/battery-low.png");
                    width: 24px;
                    height: 24px;
                    image-fit: contain;
                }

                Image {
                    visible: root.battery-percent <= 10;
                    source: @image-url("../images/icons/battery-empty.png");
                    width: 24px;
                    height: 24px;
                    image-fit: contain;
                }
            }
        }
    }

    // Settings gear icon (top-right touch target)
    Rectangle {
        x: 430px;
        y: 0px;
        width: 50px;
        height: 50px;

        Image {
            source: @image-url("../images/icons/gear-six.png");
            width: 24px;
            height: 24px;
            x: 13px;
            y: 13px;
            image-fit: contain;
        }

        TouchArea {
            clicked => {
                root.open-settings();
            }
        }
    }
}

// --- Settings Page ---
component SettingsPage inherits Rectangle {
    in-out property <float> brightness: 50;

    callback go-back();
    callback open-wifi();
    callback open-logs();
    callback open-about();
    callback brightness-changed(float);

    background: transparent;

    // Header bar
    Rectangle {
        x: 0px;
        y: 0px;
        width: 480px;
        height: 50px;
        background: #1b4f72;

        // Back arrow
        Rectangle {
            x: 0px;
            y: 0px;
            width: 50px;
            height: 50px;

            Text {
                text: "\u{2190}";
                font-size: 24px;
                color: #ffffff;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            TouchArea {
                clicked => {
                    root.go-back();
                }
            }
        }

        Text {
            x: 50px;
            width: 380px;
            text: "Settings";
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            vertical-alignment: center;
        }
    }

    // Setting items
    VerticalLayout {
        y: 60px;
        x: 20px;
        width: 440px;
        spacing: 0px;

        // Display Brightness
        Rectangle {
            height: 72px;
            background: transparent;

            VerticalLayout {
                padding-left: 12px;
                padding-right: 12px;
                spacing: 4px;

                HorizontalLayout {
                    alignment: space-between;

                    Text {
                        text: "Display Brightness";
                        font-size: 16px;
                        color: #cccccc;
                        vertical-alignment: center;
                    }

                    Text {
                        text: Math.round(root.brightness) + "%";
                        font-size: 16px;
                        color: #888888;
                        vertical-alignment: center;
                    }
                }

                Slider {
                    minimum: 10;
                    maximum: 100;
                    value: root.brightness;
                    changed(value) => {
                        root.brightness = value;
                        root.brightness-changed(value);
                    }
                }
            }

            Rectangle {
                y: 71px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }

        // WiFi
        Rectangle {
            height: 52px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: "WiFi";
                    font-size: 16px;
                    color: #cccccc;
                    vertical-alignment: center;
                }

                Text {
                    text: "\u{203A}";
                    font-size: 24px;
                    color: #555580;
                    vertical-alignment: center;
                }
            }

            TouchArea {
                clicked => {
                    root.open-wifi();
                }
            }

            Rectangle {
                y: 51px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }

        // Logs
        Rectangle {
            height: 52px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: "Logs";
                    font-size: 16px;
                    color: #cccccc;
                    vertical-alignment: center;
                }

                Text {
                    text: "\u{203A}";
                    font-size: 24px;
                    color: #555580;
                    vertical-alignment: center;
                }
            }

            TouchArea {
                clicked => {
                    root.open-logs();
                }
            }

            Rectangle {
                y: 51px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }

        // About
        Rectangle {
            height: 52px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: "About";
                    font-size: 16px;
                    color: #cccccc;
                    vertical-alignment: center;
                }

                Text {
                    text: "\u{203A}";
                    font-size: 24px;
                    color: #555580;
                    vertical-alignment: center;
                }
            }

            TouchArea {
                clicked => {
                    root.open-about();
                }
            }

            Rectangle {
                y: 51px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }
    }
}

// --- WiFi Info Page ---
component WiFiPage inherits Rectangle {
    in property <int> connected-clients: 0;
    in property <string> ip-address: "192.168.71.1";

    callback go-back();

    background: transparent;

    // Header bar
    Rectangle {
        x: 0px;
        y: 0px;
        width: 480px;
        height: 50px;
        background: #1b4f72;

        // Back arrow
        Rectangle {
            x: 0px;
            y: 0px;
            width: 50px;
            height: 50px;

            Text {
                text: "\u{2190}";
                font-size: 24px;
                color: #ffffff;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            TouchArea {
                clicked => {
                    root.go-back();
                }
            }
        }

        Text {
            x: 50px;
            width: 380px;
            text: "WiFi";
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            vertical-alignment: center;
        }
    }

    // Info rows
    VerticalLayout {
        y: 60px;
        x: 20px;
        width: 440px;
        spacing: 0px;

        for item in [
            { label: "Mode", value: "AP Mode" },
            { label: "SSID", value: "VRCBadge" },
            { label: "IP Address", value: root.ip-address },
        ]: Rectangle {
            height: 48px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: item.label;
                    font-size: 16px;
                    color: #888888;
                    vertical-alignment: center;
                }

                Text {
                    text: item.value;
                    font-size: 16px;
                    color: #ffffff;
                    vertical-alignment: center;
                }
            }

            // Divider
            Rectangle {
                y: 47px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }

        // Connected clients (dynamic value from Rust)
        Rectangle {
            height: 48px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: "Connected Clients";
                    font-size: 16px;
                    color: #888888;
                    vertical-alignment: center;
                }

                Text {
                    text: root.connected-clients == 0 ? "None" : root.connected-clients + "";
                    font-size: 16px;
                    color: root.connected-clients > 0 ? #4caf50 : #ffffff;
                    vertical-alignment: center;
                }
            }

            // Divider
            Rectangle {
                y: 47px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }
    }
}

// --- Logs Page (scrollable log viewer) ---
component LogsPage inherits Rectangle {
    in property <string> log-text: "";

    callback go-back();

    background: transparent;

    // Header bar
    Rectangle {
        x: 0px;
        y: 0px;
        width: 480px;
        height: 50px;
        background: #1b4f72;

        // Back arrow
        Rectangle {
            x: 0px;
            y: 0px;
            width: 50px;
            height: 50px;

            Text {
                text: "\u{2190}";
                font-size: 24px;
                color: #ffffff;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            TouchArea {
                clicked => {
                    root.go-back();
                }
            }
        }

        Text {
            x: 50px;
            width: 380px;
            text: "Logs";
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            vertical-alignment: center;
        }
    }

    // Log viewer (full height scrollable area)
    Rectangle {
        x: 10px;
        y: 56px;
        width: 460px;
        height: 258px;
        background: #111122;
        border-radius: 6px;

        Flickable {
            x: 8px;
            y: 6px;
            width: 444px;
            height: 246px;
            viewport-height: log-content.preferred-height;

            log-content := Text {
                width: 444px;
                text: root.log-text;
                font-size: 14px;
                color: #66cc66;
                wrap: word-wrap;
            }
        }
    }
}

// --- About Page (system info) ---
component AboutPage inherits Rectangle {
    in property <string> firmware-version: "0.0.0";
    in property <string> uptime: "0s";
    in property <string> heap-free: "0 KB";
    in property <string> psram-free: "0 KB";

    callback go-back();

    background: transparent;

    // Header bar
    Rectangle {
        x: 0px;
        y: 0px;
        width: 480px;
        height: 50px;
        background: #1b4f72;

        // Back arrow
        Rectangle {
            x: 0px;
            y: 0px;
            width: 50px;
            height: 50px;

            Text {
                text: "\u{2190}";
                font-size: 24px;
                color: #ffffff;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            TouchArea {
                clicked => {
                    root.go-back();
                }
            }
        }

        Text {
            x: 50px;
            width: 380px;
            text: "About";
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            vertical-alignment: center;
        }
    }

    // System info rows
    VerticalLayout {
        y: 60px;
        x: 20px;
        width: 440px;
        spacing: 0px;

        for item in [
            { label: "Firmware", value: root.firmware-version },
            { label: "Uptime", value: root.uptime },
            { label: "Heap Free", value: root.heap-free },
            { label: "PSRAM Free", value: root.psram-free },
        ]: Rectangle {
            height: 48px;
            background: transparent;

            HorizontalLayout {
                padding-left: 12px;
                padding-right: 12px;
                alignment: space-between;

                Text {
                    text: item.label;
                    font-size: 16px;
                    color: #888888;
                    vertical-alignment: center;
                }

                Text {
                    text: item.value;
                    font-size: 16px;
                    color: #ffffff;
                    vertical-alignment: center;
                }
            }

            // Divider
            Rectangle {
                y: 47px;
                width: 440px;
                height: 1px;
                background: #2a2a4a;
            }
        }
    }
}

// --- Main Window ---
export component BadgeUI inherits Window {
    width: 480px;
    height: 320px;
    background: #1a1a2e;

    in-out property <string> display-name: "Hebu";
    in-out property <string> tagline: "Hello from VRCBadge!";
    in-out property <string> twitter-handle: "@Hebu_VRC";
    in-out property <string> discord-handle: "hebu";
    in-out property <int> battery-percent: 85;
    in-out property <int> wifi-clients: 0;
    in-out property <string> wifi-ip: "192.168.71.1";
    in-out property <float> display-brightness: 50;
    in-out property <image> background-image;
    in-out property <image> avatar-image;
    in-out property <color> badge-background-color: #1a1a2e;
    in-out property <color> tagline-color: #e0e8f0;
    in-out property <color> tagline-background-color: #1b4f72;
    in-out property <int> current-page: 0;
    in-out property <string> firmware-version: "0.0.0";
    in-out property <string> about-uptime: "0s";
    in-out property <string> about-heap: "0 KB";
    in-out property <string> about-psram: "0 KB";
    in-out property <string> log-text: "";

    callback brightness-changed(float);

    // Badge page
    badge := BadgePage {
        visible: root.current-page == 0;
        display-name: root.display-name;
        tagline: root.tagline;
        twitter-handle: root.twitter-handle;
        discord-handle: root.discord-handle;
        battery-percent: root.battery-percent;
        background-image: root.background-image;
        avatar-image: root.avatar-image;
        background-color: root.badge-background-color;
        tagline-color: root.tagline-color;
        tagline-background-color: root.tagline-background-color;

        open-settings => {
            root.current-page = 1;
        }
    }

    // Settings page
    settings := SettingsPage {
        visible: root.current-page == 1;
        brightness: root.display-brightness;

        go-back => {
            root.current-page = 0;
        }

        open-wifi => {
            root.current-page = 2;
        }

        open-logs => {
            root.current-page = 3;
        }

        open-about => {
            root.current-page = 4;
        }

        brightness-changed(value) => {
            root.brightness-changed(value);
        }
    }

    // WiFi info page
    wifi-page := WiFiPage {
        visible: root.current-page == 2;
        connected-clients: root.wifi-clients;
        ip-address: root.wifi-ip;

        go-back => {
            root.current-page = 1;
        }
    }

    // Logs page
    logs-page := LogsPage {
        visible: root.current-page == 3;
        log-text: root.log-text;

        go-back => {
            root.current-page = 1;
        }
    }

    // About page
    about-page := AboutPage {
        visible: root.current-page == 4;
        firmware-version: root.firmware-version;
        uptime: root.about-uptime;
        heap-free: root.about-heap;
        psram-free: root.about-psram;

        go-back => {
            root.current-page = 1;
        }
    }
}
